var EpsilonFramework="undefined"==typeof EpsilonFramework?{}:EpsilonFramework;EpsilonFramework.colorSchemes={init:function(){function a(){_.each(g,function(a){h.data[a]=e(a)()}),e.previewer.send("update-inline-css",h)}var b,c,d,e,f=jQuery(".epsilon-color-scheme"),g=[],h={};f.length&&(b=f.find(".epsilon-color-scheme-option"),c=f.parent().find(".epsilon-color-scheme-input"),d=jQuery.parseJSON(b.first().find("input").val()),e=wp.customize,g=[],h={action:"epsilon_generate_color_scheme_css","class":"Epsilon_Color_Scheme",id:"",data:{}},jQuery.each(d,function(a,b){g.push(a)}),_.each(g,function(b){e(b,function(b){b.bind(a)})}),jQuery(".epsilon-color-scheme-option").on("click",function(){var b=jQuery(this).attr("data-color-id"),d=jQuery.parseJSON(jQuery(this).find("input").val());jQuery.each(d,function(a,b){g.push(a),wp.customize(a).set(b)}),jQuery(this).siblings(".epsilon-color-scheme-option").removeClass("selected"),jQuery(this).addClass("selected"),c.val(b).change(),_.each(g,function(b){e(b,function(b){b.bind(a())})})}))}},EpsilonFramework.layouts={colClasses:"col12 col11 col10 col9 col8 col7 col6 col5 col4 col3 col2 col1",html:{buttonLeft:'<a href="#" data-action="left"><span class="dashicons dashicons-arrow-left"></span> </a>',buttonRight:'<a href="#" data-action="right"><span class="dashicons dashicons-arrow-right"></span> </a>'},instance:function(a){this.context=a,this.layoutButtons=this.context.find(".epsilon-button-group > a"),this.resizeButtons=this.context.find(".epsilon-layouts-setup > .epsilon-column > a"),this.maxColumns=this.layoutButtons.length,this.minSpan=parseFloat(this.context.attr("data-min-span")),this.activeColumns=null,this.lastColumnsState=null,EpsilonFramework.layouts.handle_actions(this),this.context.on("epsilon_column_count_changed epsilon_column_size_changed",EpsilonFramework.layouts._save)},init:function(a){var b=jQuery(a);jQuery.each(b,function(){new EpsilonFramework.layouts.instance(jQuery(this))})},_save:function(a){var b={columnsCount:a.instance.activeColumns,columns:{}};jQuery.each(a.instance.context.find(".epsilon-column"),function(a){b.columns[a+1]={index:a+1,span:jQuery(this).attr("data-columns")}}),a.instance.context.find("input").val(JSON.stringify(b)).trigger("change")},handle_actions:function(a){this._advanced_toggler(a),this._column_resize(a),this._column_recount(a),this._layout_select(a),this._equalize_columns(a)},_layout_select:function(a){a.layoutButtons.on("click",function(b){b.preventDefault(),jQuery(a.context).trigger({type:"epsilon_column_count_change",columns:{selected:parseFloat(jQuery(this).attr("data-button-value")),beforeSelection:a.context.find(".epsilon-layouts-setup > .epsilon-column").length}}),jQuery(this).toggleClass("active").siblings("a").removeClass("active")})},_column_recount:function(a){var b,c,d,e=(a.context,this);jQuery(a.context).on("epsilon_column_count_change",function(f){if(a.activeColumns=f.columns.selected,a.lastColumnsState=f.columns.beforeSelection,a.activeColumns!==a.lastColumnsState){if(b=a.lastColumnsState<a.activeColumns?"adding":"subtracting",c=a.activeColumns-a.lastColumnsState,"subtracting"===b)a.context.find(".epsilon-layouts-setup > .epsilon-column").slice(-(a.lastColumnsState-a.activeColumns)).remove();else for(d=0;c>d;d++)a.context.find(".epsilon-layouts-setup").append('<div class="epsilon-column col4">'+e.html.buttonLeft+e.html.buttonRight+"</div>");jQuery(a.context).trigger({type:"epsilon_column_count_changed",instance:a})}})},_column_resize:function(a){var b,c,d,e=this;a.context.find(".epsilon-layouts-setup").on("click",".epsilon-column > a",function(f){d=jQuery(this).parent(),b=d.index(),c="right"===jQuery(this).attr("data-action")?a.context.find(".epsilon-layouts-setup > .epsilon-column").eq(b+1):a.context.find(".epsilon-layouts-setup > .epsilon-column").eq(b-1),e.calc_column_resize(c,d,a)})},calc_column_resize:function(a,b,c){parseFloat(a.attr("data-columns"))!==c.minSpan&&(a.attr("data-columns",parseFloat(a.attr("data-columns"))-1).removeClass(this.colClasses).addClass("col"+a.attr("data-columns")),b.attr("data-columns",parseFloat(b.attr("data-columns"))+1).removeClass(this.colClasses).addClass("col"+b.attr("data-columns")),jQuery(this.context).trigger({type:"epsilon_column_size_changed",instance:this}))},_equalize_columns:function(a){var b=(a.context,this);jQuery(a.context).on("epsilon_column_count_changed",function(c){a.context.find(".epsilon-column").removeClass(b.colClasses).addClass("col"+12/a.activeColumns).attr("data-columns",12/a.activeColumns)})},_advanced_toggler:function(a){a.context.on("click",".epsilon-layouts-advanced-toggler",function(a){a.preventDefault(),jQuery(this).toggleClass("active"),jQuery("#"+jQuery(this).attr("data-unique-id")).slideToggle().addClass("active")})}},wp.customize.controlConstructor["epsilon-layouts"]=wp.customize.Control.extend({ready:function(){var a=this;jQuery(this.container).find("input").on("change",function(){a.setting.set(jQuery(this).val())})}}),EpsilonFramework.rangeSliders={init:function(a){var b=jQuery(a),c=b.find(".slider-container");jQuery.each(c,function(){var a=jQuery(this).find(".ss-slider"),b=jQuery(this).find(".rl-slider"),c=b.attr("id"),d=a.attr("id"),e=jQuery("#"+d).attr("data-attr-min"),f=jQuery("#"+d).attr("data-attr-max"),g=jQuery("#"+d).attr("data-attr-step");jQuery("#"+d).slider({value:jQuery("#"+c).attr("value"),range:"min",min:parseFloat(e),max:parseFloat(f),step:parseFloat(g),slide:function(a,b){jQuery("#"+c).attr("value",b.value)},stop:function(a,b){jQuery("#"+c).trigger("change")}}),jQuery(b).on("focus",function(){jQuery(this).blur()}),jQuery("#"+c).attr("value",jQuery("#"+d).slider("value")),jQuery("#"+c).on("change",function(){jQuery("#"+d).slider({value:jQuery(this).val()})})})}},wp.customize.controlConstructor["epsilon-slider"]=wp.customize.Control.extend({ready:function(){var a=this;a.container.on("change","input.rl-slider",function(){a.setting.set(jQuery(this).val())})}}),wp.customize.controlConstructor["epsilon-toggle"]=wp.customize.Control.extend({ready:function(){var a=this;a.container.on("change","input.onoffswitch-checkbox",function(){a.setting.set(jQuery(this).prop("checked"))})}}),EpsilonFramework.typography={_selectize:null,_linkedFonts:{},init:function(){var a=jQuery(".epsilon-typography-container"),b=this;a.length&&(jQuery.each(a,function(){var a=jQuery(this),c=a.attr("data-unique-id"),d=a.find("select"),e=a.find(".epsilon-typography-input");try{b._selectize=d.selectize()}catch(f){console.warn("selectize not yet loaded")}e.on("change",function(){var a=EpsilonFramework.typography._parseJson(e,c);jQuery("#hidden_input_"+c).val(a).trigger("change")}),a.find(".epsilon-typography-advanced-options-toggler").on("click",function(a){var b=jQuery(this).attr("data-toggle");a.preventDefault(),jQuery(this).toggleClass("active").parent().toggleClass("active"),jQuery("#"+b).slideToggle().addClass("active")})}),EpsilonFramework.rangeSliders.init(".epsilon-typography-container"),jQuery(".epsilon-typography-default").on("click",function(a){a.preventDefault(),EpsilonFramework.typography._resetDefault(jQuery(this))}))},_resetDefault:function(a){var b,c=jQuery(a).parent(),d=c.attr("data-unique-id"),e=c.find("select"),f=(c.find("inputs"),e[0].selectize),g={action:"epsilon_generate_typography_css","class":"Epsilon_Typography",id:d,data:{selectors:jQuery("#selectors_"+d).val(),json:{}}},h=wp.customize;f.setValue("default_font"),jQuery("#"+d+"-font-size").length&&(b=jQuery("#"+d+"-font-size").attr("data-default-font-size"),jQuery("#"+d+"-font-size").val(b).trigger("change").trigger("blur"),g.data.json["font-size"]=""),jQuery("#"+d+"-line-height").length&&(b=jQuery("#"+d+"-line-height").attr("data-default-line-height"),jQuery("#"+d+"-line-height").val(b).trigger("change").trigger("blur"),g.data.json["line-height"]=""),jQuery("#"+d+"-letter-spacing").length&&(b=jQuery("#"+d+"-letter-spacing").attr("data-default-letter-spacing"),jQuery("#"+d+"-letter-spacing").val(b).trigger("change").trigger("blur"),g.data.json["letter-spacing"]=""),g.data.json["font-family"]="default_font",g.data.json["font-weight"]="",g.data.json["font-style"]="",h.previewer.send("update-inline-css",g)},_parseJson:function(a,b){var c={action:"epsilon_generate_typography_css","class":"Epsilon_Typography",id:b,data:{selectors:jQuery("#selectors_"+b).val(),json:{}}},d=wp.customize;return jQuery.each(a,function(a,d){var e=jQuery(d).attr("id"),f=b+"-",g=jQuery(this).attr("type");e=e.replace(f,""),"checkbox"===g?c.data.json[e]=jQuery(this).prop("checked")?jQuery(d).val():"":c.data.json[e]=jQuery(d).val()}),d.previewer.send("update-inline-css",c),JSON.stringify(c.data)}},wp.customize.controlConstructor["epsilon-typography"]=wp.customize.Control.extend({ready:function(){var a=this;jQuery(this.container).find(".customize-control-content > .epsilon-typography-input").on("change",function(){a.setting.set(jQuery(this).val())})}}),EpsilonFramework.recommendedActions={init:function(){var a=jQuery(".control-section-epsilon-section-recommended-actions"),b=a.find(".epsilon-recommended-plugin-button"),c=a.find(".epsilon-dismiss-required-action");this.dismissActions(c),this.dismissPlugins(b)},dismissActions:function(a){a.on("click",function(){var a,b,c,d=jQuery(this),e=d.parents(".epsilon-recommended-actions-container"),f=parseInt(e.attr("data-index")),g=e.parents(".control-section-epsilon-section-recommended-actions").find("h3"),h=g.find(".epsilon-actions-count > .current-index"),i=parseInt(h.attr("data-total")),j=e.next(),k={action:["Epsilon_Framework","dismiss_required_action"],args:{id:jQuery(this).attr("id"),option:jQuery(this).attr("data-option")}};jQuery.ajax({type:"POST",data:{action:"epsilon_framework_ajax_action",args:k},dataType:"json",url:WPUrls.ajaxurl,success:function(d){d.status&&"ok"===d.message&&(f>=i?(a=g.find(".section-title"),b=jQuery(".epsilon-recommended-plugins"),c=a.attr("data-social"),b.length&&(c=a.attr("data-plugin_text")),g.find(".epsilon-actions-count").remove(),a.text(c)):h.text(f+1),e.fadeOut("200",function(){j.css({opacity:1,height:"initial"}).fadeIn("200")}))},error:function(a,b,c){console.log(a+" :: "+b+" :: "+c)}})})},dismissPlugins:function(a){a.on("click",function(){var a,b,c=jQuery(this),d=c.parents(".epsilon-recommended-plugins"),e=d.next(),f=d.parents(".control-section-epsilon-section-recommended-actions").find("h3"),g={action:["Epsilon_Framework","dismiss_required_action"],args:{id:jQuery(this).attr("id"),option:jQuery(this).attr("data-option")}};jQuery.ajax({type:"POST",data:{action:"epsilon_framework_ajax_action",args:g},dataType:"json",url:WPUrls.ajaxurl,success:function(c){c.status&&"ok"===c.message&&d.fadeOut("200",function(){e.is("p")&&(a=f.find(".section-title"),b=a.attr("data-social"),a.text(b)),e.css({opacity:1,height:"initial"}).fadeIn("200")})},error:function(a,b,c){console.log(a+" :: "+b+" :: "+c)}})})}},wp.customize.sectionConstructor["epsilon-section-recommended-actions"]=wp.customize.Section.extend({attachEvents:function(){},isContextuallyActive:function(){return!0}}),wp.customize.sectionConstructor["epsilon-section-pro"]=wp.customize.Section.extend({attachEvents:function(){},isContextuallyActive:function(){return!0}}),jQuery(document).on("widget-updated widget-added",function(a,b){jQuery().slider&&EpsilonFramework.rangeSliders.init(b)}),wp.customize.bind("ready",function(){EpsilonFramework.layouts.init(".epsilon-layouts-container"),EpsilonFramework.rangeSliders.init(".customize-control-epsilon-slider"),EpsilonFramework.typography.init(),EpsilonFramework.colorSchemes.init(),EpsilonFramework.recommendedActions.init()});